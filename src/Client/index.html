<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>POI</title>
    <!-- <script src="./node_modules/jquery/dist/jquery.js"></script> -->
  </head>
  <body>
    <div class="mensajes">
      <!-- <div class="cubito" style="width: 10px; height: 10px; background:black; position:absolute;">

      </div> -->
      <canvas id="canvaspot" width="300" height="300"></canvas>
      <ul id="messages"></ul>
      <form  action="" >
        <input id="m" autocomplete="off"/><button>Send</button>
      </form>

      <button type="button" id="callBtn" name="button">Llamar</button>
    </div>
     <video autoplay id="local"></video>

    <video autoplay id="pantalla"></video>
    <button type="button" id="login" name="button">Login</button>

    <script>
    var $ = global.jQuery = require('./node_modules/jquery/dist/jquery.js');
    const ipcRenderer = require('electron').ipcRenderer
    var io = require('./node_modules/socket.io-client/dist/socket.io.js')
    const remote = require("electron").remote
    var window = remote.getCurrentWindow()
    //
    var socket = io('http://localhost:8001');
    var userName = {name: makeid()}
    // var rtc = require('webrtc.io-client');
    // console.log(rtc);
    // ipcRenderer.on('new-message', (event, arg) => {
    //    $('#messages').append($('<li>').text(arg))
    // })


    $("#login").click(() =>{
      socket.emit('login', JSON.stringify(userName))
    })

    socket.on('chat message', function(msg){
      $('#messages').append($('<li>').text(msg));
    })

    socket.on('login', function(data){
      console.log(data)
    })

    socket.on('offer', function(data){
      handleOffer(data.offer, data.name)
    })

    socket.on('answer', function(data){
      handleAnswer(data.offer, data.name)
    })

    socket.on('offer', function(data){
      handleOffer(data.offer, data.name)
    })


    $('form').submit(() => {
      // ipcRenderer.send('response-message', $('#m').val());
      var msg = {
        message: $('#m').val()
      }
      socket.emit('chat message', JSON.stringify(msg));
      $('#m').val('');
      return false;
    });

    // 'use strict';
    // navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedua;
    // //
    // var constraints = {
    //   audio: false,
    //   video: true
    // };
    //
    // var video = $("#local");
    // //
    // function successCallback(stream){
    //   window.stream = stream;
    //   if(window.URL) {
    //     video.src = URL.createObjectURL(stream);
    //
    //     var configuration = {
    //       "iceServers": [{ "url" : "nel"}]
    //     }
    //
    //     yourConn = new webkitRTCPeerConnection(configuration)
    //
    //     yourConn.addStream(stream)
    //     yourConn.onaddstream = function (e) {
    //       $("#pantalla").src = window.URL.createObjectURL(e.stream);
    //     }
    //
    //     yourConn.onicecandidate = function(event){
    //       if(event.candidate){
    //         socket.emit('candidate', {"candidate": event.candidate})
    //       }
    //     }
    //     socket.emit('video-frame', video.src);
    //   }else{
    //     console.log(stream)
    //     video.src = stream;
    //   }
    // }
    //
    // function errorCallback(error){
    //   console.log('navigator.getUserMedia erro: ', error);
    // }
    //
    // navigator.getUserMedia(constraints, successCallback, errorCallback);


    function makeid()
    {
      var text = "";
      var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

      for( var i=0; i < 15; i++ )
          text += possible.charAt(Math.floor(Math.random() * possible.length));

      return text;
    }
    </script>
  </body>
</html>
